<!-- build time:Tue Oct 09 2018 20:33:19 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Justice ain't gonna despend itself"><meta name="keywords" content="personal blog,chengww"><meta name="author" content="chengww,undefined"><meta name="copyright" content="chengww"><title>Justice ain't gonna despend itself | chengww</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="//js-cdn.pek3b.qingstor.com/font-awesome/4.7.0/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="//js-cdn.pek3b.qingstor.com/gitalk/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script>var GLOBAL_CONFIG={root:"/",algolia:{appId:"9MDSHB6H5Q",apiKey:"dcd60de5b19990f45484d2d870ae2d1c",indexName:"blog_search",hits:{per_page:10},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容:${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"}}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="//js-cdn.pek3b.qingstor.com/pic/Sayuri.jpg"></div><div class="author-info__name text-center">chengww</div><div class="author-info__description text-center">Justice ain't gonna despend itself</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">6</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div></div></div><nav class="//js-cdn.pek3b.qingstor.com/pic/Prairie%20and%20deer.jpg" id="nav" style="background-image:url(//js-cdn.pek3b.qingstor.com/pic/Prairie%20and%20deer.jpg)"><div id="page-header"><span class="pull-left"><a id="site-name" href="/">chengww</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div><div id="site-info"><div id="site-title">chengww</div><div id="site-sub-title">Justice ain't gonna despend itself</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/chengww5217" target="_blank"><i class="fa fa-github"></i></a><a class="social-icon" href="mailto:chengww5217@163.com" target="_blank"><i class="fa fa-envelope"></i></a><a class="social-icon search"><i class="fa fa-search"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/Android/AndroidStudio上传代码到码云(Oschina)教程/">AndroidStudio上传代码到码云(Oschina)教程</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a></span><div class="content"><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>用git上传代码一般用的是github，但是由于国内的情况，不进行科学上网的话那个速度简直是龟速。再就是公司那个10M的小水管实在是带不动，以及付费创建私有项目等，只好转战国内的代码托管站点。<br>我一直使用的都是oschina，但是一直有个问题，就是Android studio的VCS工具一直上传不了代码，一直被拒绝。今天终于搞清楚了，教程请往下看。</p><h4 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h4><p>1.首先前往码云<a href="https://git.oschina.net/" target="_blank" rel="noopener">注册账号</a>，没什么好说的，全中文的。<br>2.码云右上方加号，创建项目</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-c1f71b7b7b27c4de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建项目"></p><p>这个默认使用Readme初始化项目。如果你不使用任何文件初始化你的项目，即不勾选下图所有的复选框，那么就不会有冲突问题了。也就是和上传到GitHub一样，完全不会被拒绝。</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-e9792c8b140c15fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>以下教程以使用Readme初始化项目为例，教大家如何将项目上传到码云，也同样适用于解决分支冲突的问题。</p><p>3.完成后，和上传到github步骤一样</p><ul><li>打开Android Studio–VCS–Enable Version Control Integration…</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-c7e86f5a523f339a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="VCS"></p><ul><li>下拉选择git</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-8b25db2a5d493ea7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>然后仓库就创建好了，此时左方文件应显示为红色</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-082646096a1f177d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>然后VCS–git–add 代码添加到git仓库</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-b1e4cd31c1526b43.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>有提示是否将vcs.xml （版本控制的配置文件） 也一并加入到仓库，这个随意。</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-70c7f344eede35fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>右上commit changes</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-2de2179aa30322a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>commit and push 或者commit 然后再push也是一样</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-413524cd7060f0ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>项目界面复制仓库地址，填写仓库地址，填写oschina用户名密码。第一次需要设定一个密码，以后无需登录，直接输入密码即可。然后push等待被拒绝</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-a2eaf0d562b6238a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="仓库地址"><br><img src="http://upload-images.jianshu.io/upload_images/4971025-1bb0bf637681f15f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-a3648b05b8e851d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="等待被拒绝提示"></p><ul><li>VCS–git–pull（看清楚不是push）拉取Readme.md<br>进行拉取Readme.md操作前，一定要把本地git仓库未commit的文件commit。因进行VCS操作后，android studio会自动添加vcs.xml等文件到git。</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-cde912b2d46aa55a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>刷新按钮，刷新出master勾选–pull</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-f0d748af2c5bfdc8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>如果出现提示 <code>fatal: refusing to merge unrelated histories</code> 不能合并不同的仓库的提示，请前往你项目的文件夹，右键 Git Base here.<br>输入 <code>git pull origin master --allow-unrelated-histories</code> 回车，等待合并拉取到Readme.md，关闭窗口。</p><ul><li>下方VersionControl可以看到readme.md已经被拉取</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-d3763b7fc0f0b032.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>再次push就可以了</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-91190e4f0fcfda34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><ul><li>刷新oschina仓库地址，大功告成</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-67973572f7ad2d54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/Android/闪烁加载视图---ShimmerRecyclerView/">闪烁加载视图---ShimmerRecyclerView</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a></span><div class="content"><p>今天看到一个和支付宝加载RecyclerView显示加载中动画类似的库，感觉很有意思，参照官网说明写一个粗浅的使用说明给大家分享下。</p><h5 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h5><h6 id="ShimmerRecyclerView"><a href="#ShimmerRecyclerView" class="headerlink" title="ShimmerRecyclerView"></a>ShimmerRecyclerView</h6><p>一个自定义循环视图，带有shimmer视图，用来表现视图正在加载中。这个循环视图有一个内置的适配器来控制shimmer性能并提供两个方法：</p><ul><li>showShimmerAdapter() - 设置一个demo(加载中)适配器，显示预设子demo视图的数量。</li><li>hideShimmerAdapter() -隐藏加载中视图，恢复适配器以显示实际的子元素.<br>具体的显示效果如下：</li></ul><table><thead><tr><th>List Demo</th><th>Grid Demo</th></tr></thead><tbody><tr><td><img src="http://upload-images.jianshu.io/upload_images/4971025-ddfdb1e0bfe05002.gif?imageMogr2/auto-orient/strip" alt=""></td><td><img src="http://upload-images.jianshu.io/upload_images/4971025-4d1c7c3c0bcc5ce6.gif?imageMogr2/auto-orient/strip" alt=""></td></tr></tbody></table><h6 id="属性和方法"><a href="#属性和方法" class="headerlink" title="属性和方法"></a>属性和方法</h6><p>按如下属性和方法初始化demo视图.</p><table><thead><tr><th style="text-align:center">XML 属性</th><th style="text-align:center">Java 方法</th><th style="text-align:center">Explanation</th></tr></thead><tbody><tr><td style="text-align:center">app:demo_child_count</td><td style="text-align:center">setDemoChildCount(int)</td><td style="text-align:center">在shimmer适配器中展现设置demo视图的数量(Integer)。</td></tr><tr><td style="text-align:center">app:demo_layout</td><td style="text-align:center">setDemoLayoutReference(int)</td><td style="text-align:center">定义my_demo_view.xml ,请参考布局[1]。</td></tr><tr><td style="text-align:center">app:demo_layout_manager_type</td><td style="text-align:center">setDemoLayoutManager(LayoutManagerType)</td><td style="text-align:center">演示视图布局管理。</td></tr></tbody></table><p>[1] 一个显示List Demo的 my_demo_view.xml（加载中） 的例子：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">              android:layout_width=&quot;match_parent&quot;</span><br><span class="line">              android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">              android:layout_marginBottom=&quot;4dp&quot;</span><br><span class="line">              android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">              android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">              android:layout_marginTop=&quot;4dp&quot;</span><br><span class="line">              android:background=&quot;@drawable/bg_card&quot;</span><br><span class="line">              android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginTop=&quot;16dp&quot;</span><br><span class="line">        android:background=&quot;@android:color/white&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;</span><br><span class="line">        android:paddingLeft=&quot;8dp&quot;</span><br><span class="line">        android:paddingRight=&quot;8dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;78dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:paddingLeft=&quot;8dp&quot; &gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot;  /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot;  /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot;  /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;View</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;6dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">                android:alpha=&quot;0.1&quot;</span><br><span class="line">                android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;View</span><br><span class="line">            android:layout_width=&quot;78dp&quot;</span><br><span class="line">            android:layout_height=&quot;78dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;8dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;8dp&quot;</span><br><span class="line">            android:alpha=&quot;0.1&quot;</span><br><span class="line">            android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginBottom=&quot;16dp&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">        android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot; &gt;</span><br><span class="line"></span><br><span class="line">        &lt;View</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;6dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;6dp&quot;</span><br><span class="line">            android:alpha=&quot;0.1&quot;</span><br><span class="line">            android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;View</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;6dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">            android:alpha=&quot;0.1&quot;</span><br><span class="line">            android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;View</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;6dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;3dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;3dp&quot;</span><br><span class="line">            android:alpha=&quot;0.1&quot;</span><br><span class="line">            android:background=&quot;@android:color/background_dark&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure><p></p><p>[1.1] @drawable/bg_card:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line">    &lt;corners android:radius=&quot;3dp&quot; /&gt;</span><br><span class="line">    &lt;solid android:color=&quot;@android:color/white&quot; /&gt;</span><br><span class="line">    &lt;stroke</span><br><span class="line">        android:width=&quot;1dp&quot;</span><br><span class="line">        android:color=&quot;#d6d6d6&quot; /&gt;</span><br><span class="line">&lt;/shape&gt;</span><br></pre></td></tr></table></figure><p></p><h6 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h6><p>1.将本库添加到你的项目中<br>在你的项目级build.gradle文件中添加下列设置：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">	...</span><br><span class="line">	maven &#123; url &apos;https://jitpack.io&apos; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>module下build.gradle文件中添加依赖：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.github.sharish:ShimmerRecyclerView:v1.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>2.定义你的xml:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;com.cooltechworks.views.shimmer.ShimmerRecyclerView</span><br><span class="line">xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">android:id=&quot;@+id/shimmer_recycler_view&quot;</span><br><span class="line">android:layout_width=&quot;match_parent&quot;</span><br><span class="line">android:layout_height=&quot;match_parent&quot;</span><br><span class="line">app:demo_child_count=&quot;10&quot;</span><br><span class="line">app:demo_grid_child_count=&quot;2&quot;</span><br><span class="line">app:demo_layout=&quot;@layout/layout_demo_grid&quot;</span><br><span class="line">app:demo_layout_manager_type=&quot;grid&quot; /&gt;</span><br></pre></td></tr></table></figure><p></p><p>@layout/layout_demo_grid指在加载spinner时展现的示例布局(参考[1])。<br>3.在你的Activity onCreate()方法中，初始化shimmer如下：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ShimmerRecyclerView shimmerRecycler = (ShimmerRecyclerView) findViewById(R.id.shimmer_recycler_view);</span><br><span class="line">shimmerRecycler.setLayoutManager(layoutManager);</span><br><span class="line">shimmerRecycler.setAdapter(mAdapter);</span><br><span class="line">//显示加载中</span><br><span class="line">shimmerRecycler.showShimmerAdapter();</span><br></pre></td></tr></table></figure><p></p><p>4.耗时操作后显示真正要显示的内容，然后隐藏加载中：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shimmerRecycler.hideShimmerAdapter();</span><br></pre></td></tr></table></figure><p></p><p>其余操作和RecyclerView一样，要完成上拉加载下拉刷新，点击事件等同RecyclerView可以在Adapter中完成。</p><p>项目官网地址：<a href="https://github.com/sharish/ShimmerRecyclerView" target="_blank" rel="noopener">https://github.com/sharish/ShimmerRecyclerView</a></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/Java/使用JAVA合并哔哩哔哩手机客户端下载的视频/">使用JAVA合并哔哩哔哩手机客户端下载的视频</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span><div class="content"><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>使用哔哩哔哩手机客户端下载的视频在电脑上播放，无奈视频是分段的，每次都只好手动的合并再播放。而且客户端下载的视频不会按网页文件名命名，而是以av号–全数字命名。最可怕的是，每次打开一集的时候，进入的目录层级得吓死人。</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-6adc8d71eced2d05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="视频层级"></p><p>最最可怕的是，新版客户端默认文件后缀是 <em>.blv</em> 。难道我们要一个一个重命名然后再合并吗？<br>NO！这种重复的事情交给计算机就好了。</p><p>自己动手丰衣足食，我们就动手写个JAVA版的哔哩哔哩视频合并小程序。</p><p>完整项目地址: <a href="http://git.oschina.net/chengww5217/BiliBiliMerge" target="_blank" rel="noopener">http://git.oschina.net/chengww5217/BiliBiliMerge</a><br>直接下载使用:<br><a href="http://git.oschina.net/chengww5217/BiliBiliMerge/raw/master/run/BilibiliMeroV1.2.7z" target="_blank" rel="noopener">http://git.oschina.net/chengww5217/BiliBiliMerge/raw/master/run/BilibiliMeroV1.2.7z</a><br>使用帮助:<br><a href="http://git.oschina.net/chengww5217/BiliBiliMerge/blob/master/README.md" target="_blank" rel="noopener">http://git.oschina.net/chengww5217/BiliBiliMerge/blob/master/README.md</a></p><h4 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h4><ul><li>1.自动识别文件夹下视频文件并进行合并</li><li>2.合并后以视频播放页视频名称+视频分P名称命名<br><em>F:(日剧)夺爱之冬\第一话.flv</em></li><li>3.合并完成删除源文件</li></ul><h4 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h4><ul><li>1.得到哔哩哔哩客户端下载的视频目录</li></ul><p>将哔哩哔哩手机客户端下载的视频移出手机的Android目录，如移动到根目录<br>因android MTP限制，电脑无法访问Android目录。此目录是Android应用缓存目录。<br>视频位于 <em>Android–data–tv.danmaku.bili(最下面)–download</em> 下。如图显示的数字目录即为需求目录。请将数字目录移出Android目录外。</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-e232fc2c4e9b227f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>手机连上电脑后，将上述数字目录复制或移动到电脑。</p><ul><li>2.分析视频目录结构</li></ul><p><em>8896746\1\entry.json</em> 这个json包含了整个播放目录的名称和每一P的名称<br><em>8896746\1\lua.flv.bili2api.3 .blv</em> 这个文件夹就是各分段视频文件了。<br>注意：视频文件命名逻辑是：<em>0.blv,1.blv…9.blv,10.blv…</em><br>也就是说，一旦视频文件超过10个，如 0-10，合并的时候会出现这样的合并顺序：<em>0.blv–1.blv–10.blv–2.blv…</em> 所以说，我们需要先把 <em>0.blv-9.blv</em> 重命名为 <em>00.blv-09.blv</em></p><ul><li>3.FLV科普</li></ul><blockquote><p>FLV是一个二进制文件，由文件头（FLV header）和很多tag组成。tag又可以分成三类：audio,video,script，分别代表音频流，视频流，脚本流（关键字或者文件信息之类）。<br>FLV文件=FLV头文件+ tag1+tag内容1 + tag2+tag内容2 + …+… + tagN+tag内容N。</p></blockquote><p>也就是说合并FLV分段视频的时候不能简单粗暴的将多个flv视频片段按字节流的方式写到一个文件中。<br>这时候来看FLV合并的原理：</p><blockquote><p>（1） flv 文件由1个header和若干个tag组成；<br>（2） header记录了视频的元数据；<br>（3） tag 是有时间戳的数据；<br>（4） flv合并的原理就是把多个文件里的tag组装起来，调整各tag的时间戳。<br>（5）判断是否为第一个文件，是则安装头部。</p></blockquote><ul><li>了解了这些就可以动手撰写我们的合并程序了。Let’s go.</li></ul><h4 id="流程逻辑"><a href="#流程逻辑" class="headerlink" title="流程逻辑"></a>流程逻辑</h4><ul><li><p>提示输入哔哩哔哩下载的视频文件夹(输入文件夹)，输入输出的文件夹。<br>因最后合并完成后要删除源文件，故要求输出文件夹不能和输入文件夹相同。<br>一次输入多个输入文件夹以英文逗号隔开。</p></li><li><p>然后进入输入文件夹下– <em>entry.json</em> 得到视频名称，和输入文件夹拼接创建目录。<br>如：输出到 <em>F:\视频名称</em> 文件夹</p></li><li><p>执行合并<br>listFiles()执行两次进入到这个文件夹</p></li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-bdde624877eee9f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>entry.json得到视频每一P的名称，拼接输出如 <em>F:\视频名称\第一话.flv</em><br>判断进入 <em>lua.flv.bili2api.3</em> 文件夹即可得到所有视频文件<br>判断对 <em>0.flv-9.flv</em> 进行重命名—&gt; <em>00.flv-09.flv</em><br>进行合并操作</p><ul><li>删除源文件</li></ul><h4 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h4><ul><li>1.首先eclipse建项目<br>包结构很简单</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/4971025-937658844f30c2e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="包结构"></p><ul><li>2.输入输出文件夹<br>包含main方法的Bilibili.java<br>输入输出文件夹</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">      File out;</span><br><span class="line">File[] in = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">	<span class="keyword">boolean</span> isBreak = <span class="keyword">true</span>;</span><br><span class="line">	Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">	String line = scanner.nextLine();</span><br><span class="line">	<span class="keyword">if</span>(line == <span class="keyword">null</span> || line.length() == <span class="number">0</span>)&#123;</span><br><span class="line">		System.out.println(<span class="string">"输入不为空，请重试："</span>);</span><br><span class="line">		isBreak = <span class="keyword">false</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		String[] lines = line.split(<span class="string">","</span>);</span><br><span class="line">		in = <span class="keyword">new</span> File[lines.length];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; lines.length;i++)&#123;</span><br><span class="line">			in[i] = <span class="keyword">new</span> File(lines[i]);</span><br><span class="line">			<span class="keyword">if</span>(!in[i].exists())&#123;</span><br><span class="line">				System.out.println(in[i].getAbsolutePath() + <span class="string">"文件夹不存在，请重试："</span>);</span><br><span class="line">				isBreak = <span class="keyword">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(isBreak)&#123;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"请输入输出路径："</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">	Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">	String line = scanner.nextLine();</span><br><span class="line">	out = <span class="keyword">new</span> File(line);</span><br><span class="line">	<span class="keyword">if</span>(!out.exists())&#123;</span><br><span class="line">		System.out.println(<span class="string">"文件夹不存在，请重试："</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> isEquals = <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; in.length;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(out.getAbsolutePath().equals(in[i].getAbsolutePath()))&#123;</span><br><span class="line">				isEquals = <span class="keyword">false</span>;</span><br><span class="line">				System.out.println(<span class="string">"输出路径和某个输入路径相同，请重试："</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(isEquals)&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>3.循环读取多个输入目录的视频名称</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//循环</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; in.length;i++)&#123;</span><br><span class="line">			<span class="comment">//得到播放文件名，如"(日剧)夺爱之冬"</span></span><br><span class="line">			String path = in[i].getAbsolutePath() +separator+ <span class="string">"1"</span>+separator+<span class="string">"entry.json"</span>;</span><br><span class="line">			String line = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				BufferedReader reader =  </span><br><span class="line">	                <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(path), Charset.forName(<span class="string">"utf-8"</span>))); </span><br><span class="line">				line = reader.readLine();</span><br><span class="line">				reader.close();</span><br><span class="line">				System.out.println(<span class="string">"json="</span>+line);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">			<span class="comment">//输出路径</span></span><br><span class="line">			String[] names = tool.json_getName(line);</span><br><span class="line">			String episode_path = out.getAbsolutePath() + separator + names[<span class="number">0</span>];</span><br><span class="line">			File episode = <span class="keyword">new</span> File(episode_path);</span><br><span class="line">			<span class="keyword">if</span>(!episode.exists())&#123;</span><br><span class="line">				episode.mkdirs();</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"输出："</span>+episode_path);</span><br><span class="line">			<span class="comment">//合并</span></span><br><span class="line">			tool.doMerge(in[i], episode_path);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure><ul><li>4.判断对 <em>0.flv-9.flv</em> 进行重命名—&gt; <em>00.flv-09.flv</em> 后合并</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void doMerge(File in,String episode_path)&#123;</span><br><span class="line">		//1、2、3、4...</span><br><span class="line">		File[] files = in.listFiles();</span><br><span class="line">				</span><br><span class="line">		//循环</span><br><span class="line">		for(File f : files)&#123;</span><br><span class="line">			//文件名，如第一话</span><br><span class="line">			String name = null;</span><br><span class="line">			//获得所有名为.blv的文件</span><br><span class="line">			File[] ffs = null;</span><br><span class="line">			File[] fs = f.listFiles();</span><br><span class="line">			for(final File ff : fs)&#123;</span><br><span class="line">				if(ff.getName().equals(&quot;entry.json&quot;))&#123;</span><br><span class="line">					String json_name = null;</span><br><span class="line">					try &#123;</span><br><span class="line">						BufferedReader reader =  </span><br><span class="line">						              new BufferedReader(new InputStreamReader(new FileInputStream(ff), Charset.forName(&quot;utf-8&quot;)));</span><br><span class="line">						json_name = reader.readLine();</span><br><span class="line">						reader.close();</span><br><span class="line">					&#125; catch (Exception e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">						name = json_getName(json_name)[1];</span><br><span class="line">					&#125;</span><br><span class="line">					if(ff.isDirectory() &amp;&amp; ff.getName().startsWith(&quot;lua.&quot;))&#123;</span><br><span class="line">						//重命名</span><br><span class="line">						for(int i = 0; i &lt; ff.list().length;i++)&#123;</span><br><span class="line">							File pathname = ff.listFiles()[i];</span><br><span class="line">							//0.blv -- 00.blv</span><br><span class="line">							if(pathname.getName().endsWith(&quot;.blv&quot;) &amp;&amp; pathname.getName().length() == 5)&#123;</span><br><span class="line">								pathname.renameTo(new File(pathname.getParentFile().getAbsolutePath() + File.separator + &quot;0&quot; + i + &quot;.blv&quot;));</span><br><span class="line">							&#125;</span><br><span class="line">							if(pathname.getName().endsWith(&quot;.flv&quot;) &amp;&amp; pathname.getName().length() == 5)&#123;</span><br><span class="line">								pathname.renameTo(new File(pathname.getParentFile().getAbsolutePath() + File.separator + &quot;0&quot; + i + &quot;.flv&quot;));</span><br><span class="line">							&#125;</span><br><span class="line">							//0.blv.bdl -- 00.blv.bdl</span><br><span class="line">							if(pathname.getName().endsWith(&quot;.blv.bdl&quot;) &amp;&amp; pathname.getName().length() == 9)&#123;</span><br><span class="line">								pathname.renameTo(new File(pathname.getParentFile().getAbsolutePath() + File.separator + &quot;0&quot; + i + &quot;.blv.bdl&quot;));</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">						ffs = ff.listFiles(new FileFilter() &#123;</span><br><span class="line">								</span><br><span class="line">							public boolean accept(File pathname) &#123;</span><br><span class="line">								for(int i = 0;i &lt; ff.list().length;i++)&#123;</span><br><span class="line">									if(pathname.getName().endsWith(&quot;.blv&quot;) || pathname.getName().endsWith(&quot;.flv&quot;) || pathname.getName().endsWith(&quot;.blv.bdl&quot;))&#123;</span><br><span class="line">										return true;</span><br><span class="line">									&#125;</span><br><span class="line">								&#125;</span><br><span class="line">								return false;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;);</span><br><span class="line">						//合并</span><br><span class="line">						System.out.println(&quot;开始合并...&quot;);</span><br><span class="line">						FlvMerge mFlvMerge = new FlvMerge();</span><br><span class="line">						try &#123;</span><br><span class="line">							mFlvMerge.merge(ffs, new File(episode_path + File.separator + name + &quot;.flv&quot;));</span><br><span class="line">						&#125; catch (IOException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><ul><li>5.递归删除操作</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteFolder</span><span class="params">(File file)</span></span>&#123;  </span><br><span class="line">	    <span class="keyword">if</span>(!file.exists())&#123;  </span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">	    &#125;  </span><br><span class="line">	    <span class="keyword">if</span>(file.isFile() || file.listFiles().length == <span class="number">0</span>)&#123;  </span><br><span class="line">	        file.delete();  </span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">	    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">	        File[] files = file.listFiles();  </span><br><span class="line">	        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;  </span><br><span class="line">	            deleteFolder(files[i]);  </span><br><span class="line">	        &#125;  </span><br><span class="line">	        file.delete();  </span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><ul><li>6.具体怎么对FLV视频进行合并的，<a href="http://git.oschina.net/chengww5217/BiliBiliMerge/blob/master/src/com/chengww/tools/FlvMerge.java" target="_blank" rel="noopener">请点击这里</a> ，注释比较清晰。</li></ul></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/Android/安卓指纹+密码支付(解锁)仿支付宝Demo/">安卓指纹+密码支付(解锁)仿支付宝Demo</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a></span><div class="content"><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>Google从Android6.0（api23）就开始提供标准指纹识别支持，并对外提供指纹识别相关的接口。但是Android上的指纹识别似乎就是用来解锁手机屏幕，三方APP应用指纹的也是寥寥无几。一直想踩下安卓指纹识别的坑，直到这两天终于空出时间来尝试下android指纹识别的应用。</p><p>好吧，废话说不下去了，直接上Demo截图：</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-5980b43995a5011b.gif?imageMogr2/auto-orient/strip" alt="Screenrecorder-2017-05-14-02-50-58-795_20170514164200.gif"></p><h2 id="2-使用指纹识别"><a href="#2-使用指纹识别" class="headerlink" title="2.使用指纹识别"></a>2.使用指纹识别</h2><p>点击指纹识别button，弹出如图弹窗，弹窗使用DialogFragment。具体实现请看下面<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3.使用密码解锁</span><br></pre></td></tr></table></figure><p></p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-a10311fab7a862be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot_2017-05-14-14-53-29-795_com.chengww.fingerdemo.png"></p><p><strong>指纹识别的使用</strong></p><p><strong>官方标准库</strong><br>Google提供的与指纹识别相关的核心类不多，主类是FingerprintManager，主类依赖三个内部类，如下图所示：<br><img src="http://upload-images.jianshu.io/upload_images/4971025-cc31192324b0d8fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>FingerprintManager主要提供三个方法如下：<br><img src="http://upload-images.jianshu.io/upload_images/4971025-8399e8c5be486f6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>FingerprintManager.AuthenticationCallback类提供的回调接口如下，重点区分红色下划线标注的部分<br><img src="http://upload-images.jianshu.io/upload_images/4971025-ca072e6cb5b6f95e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><strong>启动指纹识别接口</strong><br><img src="http://upload-images.jianshu.io/upload_images/4971025-6f885ffea4ff74ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>看了上面的介绍，如果要写代码就变得简单了</p><p><strong>1. AndroidManifest权限声明</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.USE_FINGERPRINT&quot;/&gt;</span><br></pre></td></tr></table></figure><p></p><p><strong>2. 获取FingerManager服务对象</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static FingerprintManager getFingerprintManager(Context context) &#123; </span><br><span class="line">    FingerprintManager fingerprintManager = null;</span><br><span class="line">       try &#123;</span><br><span class="line">           fingerprintManager = (FingerprintManager)context.getSystemService(Context.FINGERPRINT_SERVICE); </span><br><span class="line">      &#125; catch (Throwable e) &#123; </span><br><span class="line">            Log.e(&quot;TAG&quot;,&quot;have not class FingerprintManager&quot;);</span><br><span class="line">     &#125; </span><br><span class="line">     return fingerprintManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>3. 启动指纹识别</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mFingerprintManager.authenticate(cryptoObject, mCancellationSignal, 0, mAuthCallback, null);</span><br></pre></td></tr></table></figure><p></p><p><strong>官方v4兼容包</strong></p><p>上面介绍最标准的官方实现指纹识别的方式，当然适配肯定没这么简单，因为有很多设备兼容性要考虑，Google后续再v4包中提供了一套完整的实现，实现类与上面的一一对应的，就是改了个名字（FingerprintManager改为了FingerprintManagerCompat，机智的发现Compat是兼容的意思，所以Google在v4包中做了一些兼容性处理），做了很多兼容处理，官方推荐使用后者。v4包中类结构如下：<br><img src="http://upload-images.jianshu.io/upload_images/4971025-34339d22c283a9dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>v4包中的类使用与上面标准库中的一致，就是名字不一样而已，这里不再介绍使用方式。</p><h2 id="3-使用密码解锁"><a href="#3-使用密码解锁" class="headerlink" title="3.使用密码解锁"></a>3.使用密码解锁</h2><p>指纹识别失败达到一定次数调用密码解锁，同指纹识别弹窗一样使用DialogFragment。用这个DialogFragment有个坑，稍后再讲。</p><p><img src="http://upload-images.jianshu.io/upload_images/4971025-6a19c00235e5f3a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot_2017-05-14-14-53-47-312_com.chengww.fingerdemo.png"></p><p>密码解锁弹窗样式，fragment_pwd.xml<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;40dp&quot;</span><br><span class="line">        android:layout_marginRight=&quot;40dp&quot;</span><br><span class="line">        android:layout_marginTop=&quot;100dp&quot;</span><br><span class="line">        android:background=&quot;@drawable/shape_dialog&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:paddingBottom=&quot;@dimen/spacing_large&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                style=&quot;@style/style_black_normal_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;@dimen/text_item_height&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:gravity=&quot;center&quot;</span><br><span class="line">                android:text=&quot;请输入密码&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/iv_close&quot;</span><br><span class="line">                android:layout_width=&quot;20dp&quot;</span><br><span class="line">                android:layout_height=&quot;20dp&quot;</span><br><span class="line">                android:background=&quot;@drawable/selector_item_pressed&quot;</span><br><span class="line">                android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">                android:layout_centerVertical=&quot;true&quot;</span><br><span class="line">                android:layout_marginRight=&quot;@dimen/spacing_tiny&quot;</span><br><span class="line">                android:src=&quot;@mipmap/icon_del&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;View style=&quot;@style/style_separate_line&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.chengww.fingerdemo.PwdView</span><br><span class="line">            android:id=&quot;@+id/pwdView&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;@dimen/spacing_large&quot;</span><br><span class="line">            android:layout_marginRight=&quot;@dimen/spacing_large&quot;</span><br><span class="line">            android:background=&quot;@color/white&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/tv_miss_pwd&quot;</span><br><span class="line">            style=&quot;@style/style_blue_normal_text&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginTop=&quot;@dimen/text_item_right_margin&quot;</span><br><span class="line">            android:layout_marginEnd=&quot;@dimen/text_item_right_margin&quot;</span><br><span class="line">            android:layout_marginRight=&quot;@dimen/text_item_right_margin&quot;</span><br><span class="line">            android:text=&quot;忘记密码?&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_item_pressed&quot;</span><br><span class="line">            android:layout_gravity=&quot;end&quot;</span><br><span class="line">            android:gravity=&quot;center&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.chengww.fingerdemo.InputMethodView</span><br><span class="line">        android:id=&quot;@+id/inputMethodView&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_alignParentBottom=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure><p></p><p><strong>密码显示圆点框</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class PwdView extends View &#123;</span><br><span class="line"></span><br><span class="line">    private ArrayList&lt;String&gt; result;//输入结果保存</span><br><span class="line">    private int count;//密码位数</span><br><span class="line">    private int size;//默认每一格的大小</span><br><span class="line">    private Paint mBorderPaint;//边界画笔</span><br><span class="line">    private Paint mDotPaint;//掩盖点的画笔</span><br><span class="line">    private int mBorderColor;//边界颜色</span><br><span class="line">    private int mDotColor;//掩盖点的颜色</span><br><span class="line">    private RectF mRoundRect;//外面的圆角矩形</span><br><span class="line">    private int mRoundRadius;//圆角矩形的圆角程度</span><br><span class="line"></span><br><span class="line">    public PwdView(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        init(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private InputCallBack inputCallBack;//输入完成的回调</span><br><span class="line">    private InputMethodView inputMethodView; //输入键盘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public interface InputCallBack &#123;</span><br><span class="line">        void onInputFinish(String result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PwdView(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        init(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PwdView(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        init(attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化相关参数</span><br><span class="line">     */</span><br><span class="line">    void init(AttributeSet attrs) &#123;</span><br><span class="line">        final float dp = getResources().getDisplayMetrics().density;</span><br><span class="line">        this.setFocusable(true);</span><br><span class="line">        this.setFocusableInTouchMode(true);</span><br><span class="line">        result = new ArrayList&lt;&gt;();</span><br><span class="line">        if (attrs != null) &#123;</span><br><span class="line">            TypedArray ta = getContext().obtainStyledAttributes(attrs, R.styleable.PwdView);</span><br><span class="line">            mBorderColor = ta.getColor(R.styleable.PwdView_border_color, Color.LTGRAY);</span><br><span class="line">            mDotColor = ta.getColor(R.styleable.PwdView_dot_color, Color.BLACK);</span><br><span class="line">            count = ta.getInt(R.styleable.PwdView_count, 6);</span><br><span class="line">            ta.recycle();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            mBorderColor = Color.LTGRAY;</span><br><span class="line">            mDotColor = Color.GRAY;</span><br><span class="line">            count = 6;//默认6位密码</span><br><span class="line">        &#125;</span><br><span class="line">        size = (int) (dp * 30);//默认30dp一格</span><br><span class="line">        //color</span><br><span class="line">        mBorderPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mBorderPaint.setStrokeWidth(3);</span><br><span class="line">        mBorderPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mBorderPaint.setColor(mBorderColor);</span><br><span class="line"></span><br><span class="line">        mDotPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mDotPaint.setStrokeWidth(3);</span><br><span class="line">        mDotPaint.setStyle(Paint.Style.FILL);</span><br><span class="line">        mDotPaint.setColor(mDotColor);</span><br><span class="line">        mRoundRect = new RectF();</span><br><span class="line">        mRoundRadius = (int) (5 * dp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        int w = measureWidth(widthMeasureSpec);</span><br><span class="line">        int h = measureHeight(heightMeasureSpec);</span><br><span class="line">        int wsize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        int hsize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        //宽度没指定,但高度指定</span><br><span class="line">        if (w == -1) &#123;</span><br><span class="line">            if (h != -1) &#123;</span><br><span class="line">                w = h * count;//宽度=高*数量</span><br><span class="line">                size = h;</span><br><span class="line">            &#125; else &#123;//两个都不知道,默认宽高</span><br><span class="line">                w = size * count;</span><br><span class="line">                h = size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;//宽度已知</span><br><span class="line">            if (h == -1) &#123;//高度不知道</span><br><span class="line">                h = w / count;</span><br><span class="line">                size = h;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setMeasuredDimension(Math.min(w, wsize), Math.min(h, hsize));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int measureWidth(int widthMeasureSpec) &#123;</span><br><span class="line">        //宽度</span><br><span class="line">        int wmode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        int wsize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        if (wmode == MeasureSpec.AT_MOST) &#123;//wrap_content</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line">        return wsize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int measureHeight(int heightMeasureSpec) &#123;</span><br><span class="line">        //高度</span><br><span class="line">        int hmode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        int hsize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        if (hmode == MeasureSpec.AT_MOST) &#123;//wrap_content</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line">        return hsize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        if (event.getAction() == MotionEvent.ACTION_DOWN) &#123;//点击控件弹出输入键盘</span><br><span class="line">            requestFocus();</span><br><span class="line">            inputMethodView.setVisibility(VISIBLE);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onFocusChanged(boolean gainFocus, int direction, Rect previouslyFocusedRect) &#123;</span><br><span class="line">        super.onFocusChanged(gainFocus, direction, previouslyFocusedRect);</span><br><span class="line">        if (gainFocus) &#123;</span><br><span class="line">            inputMethodView.setVisibility(VISIBLE);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            inputMethodView.setVisibility(GONE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        final int width = getWidth() - 2;</span><br><span class="line">        final int height = getHeight() - 2;</span><br><span class="line">        //先画个圆角矩形</span><br><span class="line">        mRoundRect.set(0, 0, width, height);</span><br><span class="line">        canvas.drawRoundRect(mRoundRect, 0, 0, mBorderPaint);</span><br><span class="line">        //画分割线</span><br><span class="line">        for (int i = 1; i &lt; count; i++) &#123;</span><br><span class="line">            final int x = i * size;</span><br><span class="line">            canvas.drawLine(x, 0, x, height, mBorderPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        //画掩盖点,</span><br><span class="line">        // 这是前面定义的变量 private ArrayList&lt;Integer&gt; result;//输入结果保存</span><br><span class="line">        int dotRadius = size / 8;//圆圈占格子的三分之一</span><br><span class="line">        for (int i = 0; i &lt; result.size(); i++) &#123;</span><br><span class="line">            final float x = (float) (size * (i + 0.5));</span><br><span class="line">            final float y = size / 2;</span><br><span class="line">            canvas.drawCircle(x, y, dotRadius, mDotPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onCheckIsTextEditor() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public InputConnection onCreateInputConnection(EditorInfo outAttrs) &#123;</span><br><span class="line">        outAttrs.inputType = InputType.TYPE_CLASS_NUMBER;//输入类型为数字</span><br><span class="line">        outAttrs.imeOptions = EditorInfo.IME_ACTION_DONE;</span><br><span class="line">        return new MyInputConnection(this, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setInputCallBack(InputCallBack inputCallBack) &#123;</span><br><span class="line">        this.inputCallBack = inputCallBack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void clearResult() &#123;</span><br><span class="line">        result.clear();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private class MyInputConnection extends BaseInputConnection &#123;</span><br><span class="line">        public MyInputConnection(View targetView, boolean fullEditor) &#123;</span><br><span class="line">            super(targetView, fullEditor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean commitText(CharSequence text, int newCursorPosition) &#123;</span><br><span class="line">            //这里是接受输入法的文本的，我们只处理数字，所以什么操作都不做</span><br><span class="line">            return super.commitText(text, newCursorPosition);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean deleteSurroundingText(int beforeLength, int afterLength) &#123;</span><br><span class="line">            //软键盘的删除键 DEL 无法直接监听，自己发送del事件</span><br><span class="line">            if (beforeLength == 1 &amp;&amp; afterLength == 0) &#123;</span><br><span class="line">                return super.sendKeyEvent(new KeyEvent(KeyEvent.ACTION_DOWN, KeyEvent.KEYCODE_DEL))</span><br><span class="line">                        &amp;&amp; super.sendKeyEvent(new KeyEvent(KeyEvent.ACTION_UP, KeyEvent.KEYCODE_DEL));</span><br><span class="line">            &#125;</span><br><span class="line">            return super.deleteSurroundingText(beforeLength, afterLength);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置输入键盘view</span><br><span class="line">     *</span><br><span class="line">     * @param inputMethodView</span><br><span class="line">     */</span><br><span class="line">    public void setInputMethodView(InputMethodView inputMethodView) &#123;</span><br><span class="line">        this.inputMethodView = inputMethodView;</span><br><span class="line">        this.inputMethodView.setInputReceiver(new InputMethodView.InputReceiver() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void receive(String num) &#123;</span><br><span class="line">                if (num.equals(&quot;-1&quot;)) &#123;</span><br><span class="line">                    if (!result.isEmpty()) &#123;</span><br><span class="line">                        result.remove(result.size() - 1);</span><br><span class="line">                        invalidate();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    if (result.size() &lt; count) &#123;</span><br><span class="line">                        result.add(num);</span><br><span class="line">                        invalidate();</span><br><span class="line">                        ensureFinishInput();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断是否输入完成，输入完成后调用callback</span><br><span class="line">     */</span><br><span class="line">    void ensureFinishInput() &#123;</span><br><span class="line">        if (result.size() == count &amp;&amp; inputCallBack != null) &#123;//输入完成</span><br><span class="line">            StringBuffer sb = new StringBuffer();</span><br><span class="line">            for (String i : result) &#123;</span><br><span class="line">                sb.append(i);</span><br><span class="line">            &#125;</span><br><span class="line">            inputCallBack.onInputFinish(sb.toString());</span><br><span class="line">            clearResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取输入文字</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getInputText() &#123;</span><br><span class="line">        if (result.size() == count) &#123;</span><br><span class="line">            StringBuffer sb = new StringBuffer();</span><br><span class="line">            for (String i : result) &#123;</span><br><span class="line">                sb.append(i);</span><br><span class="line">            &#125;</span><br><span class="line">            return sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>下方输入键盘</strong><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class InputMethodView extends LinearLayout implements View.OnClickListener &#123;</span><br><span class="line"></span><br><span class="line">    private InputReceiver inputReceiver;</span><br><span class="line"></span><br><span class="line">    public InputMethodView(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        LayoutInflater.from(context).inflate(R.layout.view_password_input, this);</span><br><span class="line"></span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView() &#123;</span><br><span class="line">        findViewById(R.id.btn_1).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_2).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_3).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_4).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_5).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_6).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_7).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_8).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_9).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_0).setOnClickListener(this);</span><br><span class="line">        findViewById(R.id.btn_del).setOnClickListener(this);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.layout_hide).setOnClickListener(new OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                setVisibility(GONE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        String num = (String) v.getTag();</span><br><span class="line">        this.inputReceiver.receive(num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置接收器</span><br><span class="line">     * @param receiver</span><br><span class="line">     */</span><br><span class="line">    public void setInputReceiver(InputReceiver receiver)&#123;</span><br><span class="line">        this.inputReceiver = receiver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 输入接收器</span><br><span class="line">     */</span><br><span class="line">    public interface InputReceiver&#123;</span><br><span class="line"></span><br><span class="line">        void receive(String num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>MainActivity实现输入回调就可以得到回调结果了</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity implements PwdView.InputCallBack&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onInputFinish(String result) &#123;</span><br><span class="line">        if (result.equals(&quot;123456&quot;)) &#123;</span><br><span class="line">            fragment.dismiss();</span><br><span class="line">            Toast.makeText(this, &quot;验证成功&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            showPwdError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>今天暂时写这么多吧，整个项目还有点BUG，标题说仿支付宝也仿的不像，改天把后半部分整理出来修改下再发个完整版的。<br>源代码下载：<br><a href="http://git.oschina.net/chengww5217/fingerdemo" target="_blank" rel="noopener">http://git.oschina.net/chengww5217/fingerdemo</a><br>指纹解锁部分参考引用了以下文章，原作者指纹识别部分写的非常棒，强烈建议前往拜读：<br><a href="http://www.cnblogs.com/popfisher/p/6063835.html" target="_blank" rel="noopener">http://www.cnblogs.com/popfisher/p/6063835.html</a><br><a href="https://willowtreeapps.com/ideas/android-fingerprint-apis-an-overview-for-android-app-developers/" target="_blank" rel="noopener">https://willowtreeapps.com/ideas/android-fingerprint-apis-an-overview-for-android-app-developers/</a></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/科技随笔/VCD--国产专利之痛/">VCD--国产专利之痛</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/科技随笔/">科技随笔</a></span><div class="content"><p>世界上第一台家用VCD机，影音光碟（Video Compact Disc；VCD）诞生于中国合肥的”万燕”之手，”万燕”让中国的老百姓认识了VCD，并开创了中国的VCD行业。</p><p>VCD在二十世纪末消费类电子领域里，是中国可能领先的唯一机会，而在此之前本领域没有一个中国人创造并形成产业。但是当时万燕集团的掌门人、也是VCD机研制者姜万勐先生犯下令他后悔终生的致命错误：他竟然认为在当时的情况，申不申请专利没有太大的意义，以致万燕推出的第一批1000台VCD机，几乎都被国内外家电公司买去做了样机，成为解剖的对象。<br>随后，索尼、松下、飞利浦等国外制造业巨大纷纷加强对VCD机的研究，推出新的专利技术，刷新VCD的技术标准，以致包括万燕集团在内的国内家电企业生产VCD需要向这些国外巨头缴纳巨额的专利费用，在之后的七八年时间里，这些专利费用在国内市场就累积上百亿之多。<br>仅仅3到4年时间，拥有这项领先技术的万燕却最终淹没于同行业的激烈竞争中。而VCD产业，随着进入者的增多，产品利润被不断摊薄，最后这项没什么技术含量的产业，也在低价竞争中日薄西山，被DVD蚕食殆尽。</p><h3 id="VCD的前世今生"><a href="#VCD的前世今生" class="headerlink" title="VCD的前世今生"></a>VCD的前世今生</h3><h4 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h4><p>世界上第一台VCD视盘机是由国人姜万勐先生发明的，诞生于安徽万燕公司。<br>事情发生在1992年。在美国举办的国际广播电视技术展览会上。美国C-CUBE（斯高柏）公司曾展出了一项图像解压缩技术。时任安徽观代集团总经理的姜万勐先生受其启发， 敏锐地意识到：可以把图像和声音存储在一张比较小的光盘里的MPEG技术，意味着可以创造出一种物美价廉的视听产品，供老百姓在家中使用。于是在1993年，出资57万元，研制出了物美价廉的VCD（价格相比同期录像机很有优势）。同年12月，他又与美籍华人孙燕生（时任C-CUBE公司董事长）共同投资1700万美元成立了万燕公司，各取了姜万勐、孙燕生名字中的一个字作为公司名称：<strong>安徽省万燕电子系统有限公司</strong>。</p><p>但是令人匪夷所思的是，VCD真正的核心技术：万燕公司花费巨资委托C-CUBE研发的解码芯片技术，却牢牢掌握在C-CUBE斯高柏微系统公司手里。这为后来国产VCD乱局埋下了崩溃的种子。</p><h4 id="万燕的危机"><a href="#万燕的危机" class="headerlink" title="万燕的危机"></a>万燕的危机</h4><p>在1993年安徽现代电视技术研究所的VCD可行性报告中，有这样的一段描述：</p><blockquote><p>这是本世纪末消费类电子领域里，中国可能领先的惟一机会。</p></blockquote><p>为此，姜万勐进行了一系列的市场调查，得到了一系列的数字：1993年中国市场上组合音响的销售量是142万台，录像机的销售量是170余万台，LD影碟机100万台，CD激光唱机是160余万台。当时的LD光盘是四五百元一张，而VCD机的光盘价格却只有它的10％左右，因此可以预测，VCD机每年的销售量将会达到200万台左右。</p><h5 id="第一批VCD"><a href="#第一批VCD" class="headerlink" title="第一批VCD"></a>第一批VCD</h5><p>中国的老百姓到了1994年底才逐渐认识VCD。在这一年，万燕生产了几万台VCD机。不仅如此，姜万勐还要开发碟片，总不能让老百姓买了枪而没子弹。为此，他又向11家音像出版社购买了版权，推出了97种卡拉OK碟片。在最初成立不到一年的时间里，“万燕”倾其所有，开创了一个市场，确立了一个响当当的品牌，并形成了一整套成型的技术，独霸于VCD天下。<br>可以说，万燕的初创是成功的，也是辉煌的。但是，万燕也给自己酿下一杯苦酒。令姜万勐感到伤心的是，万燕推出的第一批1000台VCD机，几乎都被国内外各家电公司买去做了样机，成为解剖的对象。<br>1994年，万燕开始批量生产VCD，但初期由于片源不配套，使VCD在市场发展上停滞了很长的一段时间。</p><p>万燕所面临的难题是软硬件要一齐开发。“万燕”在前期研究开发的投入是1600万美元，广告投入是2000万元人民币，中国百姓到了1994年底才逐渐认识VCD，而在这一年，“万燕”生产了几万台VCD，结果只卖出了2万台。由于前期投入太多，导致早期产品成本高达每台360美元，再加广告费用，在市场上每台VCD卖四五千元，却基本无利可赚。 不仅如此，万燕还要开发碟片，万燕为此又向11家音像出版社购买版权，推出97种卡拉OK碟片。</p><p>投入上亿地研发资金，产品研发出来，却没有及时申请专利，进行技术垄断。其他制造商只需要花费极小的代价就能获得成套的成熟生产技术。<br>在前期的产品成本上，万燕公司就吃了大亏；接下来的败招是九四年就投入2000万的广告费用。</p><p>一直到九五年。影碟机市场还属于培育阶段，在盗版影碟大量涌现之前，影碟机的市场容量很有限。投入再多地广告费都不会起到预期地效果。<br>广告是需要连续进行投入的商业行为，一旦中断，广告就会随着时间地延长而变得毫无效果。<br>要是将2000万广告预算拖到95下半年再投入，或许能让万燕公司起死回生。<br>万燕前期投入上亿的研究资金、2000万的广告费用，迄今为止卖出去地台影碟机还没超过两万台，就算每台影碟机的售价高达四千元，万燕收回成本都困难，更不要说什么利润了。<br>万燕资金裢脱节了！<br>万燕公司在影碟机市场启动的前夜就花光了所有钱，陷入生存的危机之中。</p><p>万燕要打翻身仗，唯有继续筹集资金扩大产能，等到九五、九六年影碟机市场突然暴发的时候，利用先机大举抢占市场。<br>万燕会成功的筹集到资金吗？显然不会，不然万燕就不会是被遗忘的品牌了。<br>在盗版影碟大量出现之前，影碟机的惨淡市场、万燕的惨淡经营已经让投资人失出信心。最重要的一点就是引入影碟机整套的生产技术甚至不需要一百万的资金，然而投资万燕却要分摊万燕公司前期投入研发的上亿元成本，哪个投资人会傻到做这折本的买卖？</p><h5 id="市场蜂拥，万燕沉没"><a href="#市场蜂拥，万燕沉没" class="headerlink" title="市场蜂拥，万燕沉没"></a>市场蜂拥，万燕沉没</h5><p>1996年开始到1997年，中国的VCD市场每年以数倍的速度增长。从1995年的60万台猛增至1996年600多万台，1997年销售达到1000万台。只用了短短5年，VCD影碟机累计销售已有5000万台，并催生了爱多、步步高、新科等国内响当当的品牌。但 “万燕”却在这个产业中，从“先驱”成为“先烈”，其市场份额从100％跌到2％，也就在这一年，“万燕”被同省的美菱集团重组，成为美菱万燕公司。<br>“万燕”让中国百姓认识了VCD，但摘桃子的却是深谙市场秘诀的广东人。 此时，深谙市场秘诀的广东人却恰到好处地把握了这个良机。由于VCD整机组装对技术要求不高，没有生产许可证的限制，再加上市场已经被打开，广东又是散件水货的聚集地，几个因素凑到一起，VCD组装厂如雨后春笋般出现在了珠江三角洲。“床板工厂”开始遍布大街小巷，一个人一天可以组装10台、20台，一家老少一天就能装出几十台，市场颇为火爆。<br>在中国家电产品中，没有一种产品如VCD 般以狂飙突进的方式席卷全国。“万燕”从市场上衰落后，VCD进入了爆炸式的增长时期，有关统计显示，中国VCD企业最多的时候达1000多家，整个VCD行业风云变幻,其铺天盖地的广告攻势，高开低走的价格走势，大起大落的市场命运，无不让人刻骨铭心。</p><p>待续…</p><p>中国VCD发展历程</p><ul><li>1993年9月，留美学者姜万勐、孙燕生生产出世界上第一台VCD。</li><li>1996年至1997年，爱多、新科等新品牌开始大规模进入市场，并占据VCD大部分市场。</li><li>1998年9月，发生了全国性的SVCD与CVD标准之争论。1998年8月，信息产业部制定《超级VCD系统行业规范》，于1998年11月1日生效。</li><li>1998年10月至1999年7月，各大影碟机厂家不断推出附加新技术的VCD产品，如可播放MP3和MIDI的超级VCD，掌上型超级VCD和可录写的超级VCD。甚至实现了VCD联网和语音复读等功能，以实现中小学的VCD辅助教学。</li><li>1999年1月，影碟机行业广告费投入直线下降。在激烈竞争中，不少知名企业陷入困境，如“小霸王”倒闭和“爱多”亏损严重。</li><li>1999年7月，各主要生产厂家不约而同地开始大规模降价，普通单碟机的价格纷纷跌破800元/台。DVD产品开始取代VCD。</li></ul><p>本文综合以下文章整理：</p><ul><li>万燕VCD的衰败之路(20110629)<br><a href="https://wenku.baidu.com/view/d203a14469eae009581bec16.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/d203a14469eae009581bec16.html</a></li><li>万燕VCD的悲剧<br><a href="http://www.360doc.com/content/16/0512/15/14771698_558528759.shtml" target="_blank" rel="noopener">http://www.360doc.com/content/16/0512/15/14771698_558528759.shtml</a></li><li>中国VCD行业案例分析<br><a href="https://wenku.baidu.com/view/69283f040740be1e650e9a2a.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/69283f040740be1e650e9a2a.html</a></li></ul></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/08/给产品经理讲技术/写给产品经理之前端是如何展示后端数据的/">写给产品经理之前端是如何展示后端数据的</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/给产品经理讲技术/">给产品经理讲技术</a></span><div class="content"><p>移动互联网的迅猛发展让移动APP呈现出爆发之势，这两年更是移动开发程序员的春天。</p><p>今天的互联网上充斥着产品与技术的撕逼。也许你会问产品经理到底要不要懂技术？由此引申出，产品经理到底要不要懂设计？产品经理到底要不要懂运营？产品经理到底要不要懂市场？产品经理到底要不要懂业务？这所有问题的来源都是大家对于产品经理的工作认识不一致。<br><strong>每个人心中都有一个产品经理的定义，产品经理在技术方面更多的是去统筹和规划。不是画画图写写文档就可以了。这里面更多的需要的是对逻辑的梳理和拆分。</strong><br>例如很简单的一个app内嵌发红包的活动，产品经理需要确定整个活动的流程。从用户进入页面的那一瞬间就应该被产品经理掌控。他的每一个步骤，每一个操作会带来什么结果，有哪些变量会导致活动进程失败，这些都要产品去考虑。等到活动逻辑和过程全部梳理完成，下面就要进行拆分了。还是以发红包为例，红包中金额是客户端写死还是服务端进行计算，红包领取资格需要服务端返回几种结果，每种结果对应客户端的提示是什么，用户领取红包以后服务端需要记录那些信息（帐号，uid，领取时间，金额，是否使用等），客户端哪些地方需要加入计数器进行数据统计。总结起来其实就是，产品经理需要根据开发的每一个环节，将所有内容分类整理，并分发给不同部分的开发进行研发。最后，还需要给测试准备好check list，当测试按照check list测试完成以后，才可以上线。</p><p>以上种种都需要产品对前端如何显示后端数据有一个清晰的认识才能规划好数据如何展示。是APP写死呢还是后台返回，在用户任务进行的时候有哪些可能case。只有搞清楚这些，产品才能在实际的开发中掌握好整个项目的流程与进展，才能不被开发给糊弄。</p><h3 id="1-前后端到底在干些什么"><a href="#1-前后端到底在干些什么" class="headerlink" title="1.前后端到底在干些什么"></a>1.前后端到底在干些什么</h3><p>简单的说，前端仅仅将后端返回的数据展示在页面上，不做过多的逻辑处理。前端需要关心的是，数据如何更好的展示出来，页面效果如何做出来，以及其性能问题。<br>而后端就是负责对这些数据进行处理，提供给前端展示。</p><p>前端一般有H5、android、ios等多端界面。数据不要轻易写死在前端里面，不然到时候三端都要修改，费时费力。而将这些变化多数据让后端进行处理，前端将这个数据取出来显示出来就行了。</p><p>举个例子吧，下图是一个美团app首页团购的展示效果<br><img src="http://upload-images.jianshu.io/upload_images/4971025-0ab79486f1558e3c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="美团"></p><p>上方美食等8个icon一般为固定展示栏目，非特殊情况不会修改。那么前端一般是写死在app中，等到需要更新的时候更新app即可。</p><p>而下方猜你喜欢是一个列表，该列表数据经常变化，数据写在服务端维护，app取出数据进行展示即可。</p><h3 id="2-前端到底是怎么显示数据的"><a href="#2-前端到底是怎么显示数据的" class="headerlink" title="2.前端到底是怎么显示数据的"></a>2.前端到底是怎么显示数据的</h3><p>首先，前段对页面的展示是分两步走的。<br>第一、在本地绘制好界面，当然此时未连api会填充一些假数据，或写一些默认值。<br>第二、连api进行数据获取，将数据填充进界面。</p><p>既然如此，咱们简单看下前端拿到的数据到底长什么样的吧。<br>现在前端获取到的数据基本是json数据。</p><ul><li>何谓json数据<br>JSON是一种传递对象的语法，对象可以是name/value对，数组和其他对象。<br>拿刚才美团截图里面的猜你喜欢列表简单说下吧，如下面这一坨东西就是后端可能返回给前端的数据<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;list&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;title&quot;: &quot;合辑护甲&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;【北京市】奥斯卡货到付款...&quot;</span><br><span class="line">            &quot;price&quot;: 12.9</span><br><span class="line">            &quot;distance&quot;: &quot;145.0km&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;title&quot;: &quot;合辑护甲&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;【北京市】奥斯卡货到付款...&quot;</span><br><span class="line">            &quot;price&quot;: 12.9</span><br><span class="line">            &quot;distance&quot;: &quot;145.0km&quot;</span><br><span class="line">        &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ul><p>不需要特别懂里面每一个的含义，只需要知道，前端通过”title”这个键名(key)就可以拿到”合辑护甲”这个值(value)。<code>&quot;title&quot;: &quot;合辑护甲&quot;</code> 这一整个就是俗称的一个字段。通过该字段前端就可以获取到列表的标题了。当然这个列表只是简单的展示用，还有诸如图片地址、优惠信息、已售份额等信息没有提供，这就是缺少字段的情况。<br>前后端就是通过这样的一个定义获取/传递数据的。</p><h3 id="3-什么样的数据该由前端来控制，什么样的数据该由后端提供呢"><a href="#3-什么样的数据该由前端来控制，什么样的数据该由后端提供呢" class="headerlink" title="3.什么样的数据该由前端来控制，什么样的数据该由后端提供呢"></a>3.什么样的数据该由前端来控制，什么样的数据该由后端提供呢</h3><p>考虑到后期拓展、需求变更等，一般来说，涉及到计算的、可能有变动的，一律不要让前端来弄。<br>还是刚才那个例子，在刚才那个列表中有一个“立减5元”的橙黄色tag。<br>这个tag信息，如果考虑不充分，比如说，后端只提供一个数字5，然后前端在其页面写死“立减x元”，x为填入后端提供的数字，颜色固定为橙黄色。这个如果需求不修改还好，如果后期需要新增一个“满20减5元”的红色tag不傻眼了吗？<br>到时候只能通过升级app来解决，而且不升级的老用户将永远看不到这个红色的tag。<br>所以说，考虑到程序的可复用和拓展性，需要产品将后期可能新增或变更的需求考虑好，和前后端进行沟通，让前后端设计好实现，尽量降低程序的耦合和硬编码。这才能使一个产品更加健壮以及让苦逼的程序猿少加班的关键。</p><p>那么刚才那个tag的需求如何设计才合理呢？<br>首先是tag显示文字，全权由后端提供，可以是多个字段，由前端进行拼接。然后是tag的颜色，提供几种样式让前端判断是一种可行的办法，但是直接提供tag的色值给前端的这种方式无疑给前端展示增加了无限的可能。<br>是不是也要增加一个tag形状的字段呢？<br>俗话说，过犹不及。tag形状这种东西真的很少变更，字段太多无疑会增加开发的时间成本，而且会让人有一种舍本逐末之感。</p><h3 id="4-前端数据刷新时机问题"><a href="#4-前端数据刷新时机问题" class="headerlink" title="4.前端数据刷新时机问题"></a>4.前端数据刷新时机问题</h3><p>前端获取到后端数据后，如果前端不主动刷新重新请求数据的话，这个页面的数据在该页面销毁前会一直保持不变。</p><p>如何理解？<br>首先，第一次进入一个页面，该页面数据为空或默认数据。此时前端会链接api请求数据。数据请求完成后，填充进页面。那么本次联网请求就完成了，在前端不进行二次数据请求之前，该页面会一直保持本次请求的数据。也就是说，就算服务端修改了数据，前端此时是不能事实的进行更新的，因为我前端不知道你数据更新了。</p><p>那么在这个需要实时更新页面数据的时候和前端讲这种需求会被前端直接回绝：“做不了”。这个时候产品咋办，怪怪妥协？最后背锅的还是自己，而且自己也不知道是真做不了还是假做不了。</p><p>实时刷新也不是不能做，只是做的成本略高，需要和后端进行配合，像微信聊天一样和后端进行长连接(socket)，这样服务端数据变更前端就知道数据变更了。<br>当然如果稍懂页面刷新机制的话，可以要求前端在适当的时机进行页面刷新，如在页面可见的时候进行刷新，这样用户每次看到的都是最新的数据。也可以让用户主动刷新，如新增刷新功能。</p><h3 id="5-One-more-thing"><a href="#5-One-more-thing" class="headerlink" title="5.One more thing"></a>5.One more thing</h3><p>产品懂技术这件事情，不仅会降低和开发同学沟通时的难度和被歧视风险，还会提升在面对开发同学意见时的判断力，会降低被技术团队忽悠的几率。同时，在需要向上级解释技术原因导致变更的情况下，也会有助于说服老板。<br>“闻道有先后，术业有专攻”，要相信自己所接触的开发团队是专业的，靠谱的，相信开发团队为实现需求所做出的技术方案是合理的，最优的。如果有质疑，可以加深沟通，以合适的方式提出自己的质疑。这里要补充一句的是，这个信任过程是需要建立的，也是会根据团队的表现不断变化的；同理，其实团队对于产品经理的信任度也是一样的情况。<br>吐槽是没有意义的，关键还是要解决问题。如果觉得产品经理不靠谱，那么有没有进行过深入的沟通？如果觉得开发不好沟通，那么有没有进行过了解，不好沟通的原因在哪里？如果当事人本身确实不可沟通，那么有没有考虑和对方的老板沟通，或者通过自己的老板如实反映情况？吐槽是最容易的，解决问题反而会很难。</p></div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 By chengww</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Love me, kiss me, fuck you</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="//js-cdn.pek3b.qingstor.com/theme-melody/anime.min.js"></script><script src="//js-cdn.pek3b.qingstor.com/jquery/3.2.1/jquery.min.js"></script><script src="//js-cdn.pek3b.qingstor.com/theme-melody/jquery.fancybox.min.js"></script><script src="//js-cdn.pek3b.qingstor.com/theme-melody/velocity.min.js"></script><script src="//js-cdn.pek3b.qingstor.com/theme-melody/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script><script src="/js/search/algolia.js"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html><!-- rebuild by neat -->